function addItem(e){function t(e){switch(e.className){case"hero":haveHero=!1,theHero=null;break;case"killer":robots.forEach(function(t,o){t.getLocation()===e.id&&robots.splice(o,1)});break;case"treasure":treasures.forEach(function(t,o){t.getLocation()===e.id&&treasures.splice(o,1)});break;case"obstacle":obstacles.forEach(function(t,o){t.getLocation()===e.id&&obstacles.splice(o,1)})}}if(inSetup){var o=prompt("Please enter a value in the following range: 0-9, o, h, k");if(t(e),"h"===o)haveHero?(alert("You can only have one hero!"),console.log(theHero)):(document.getElementById(e.id).className="hero",theHero=new Hero(e.id),haveHero=!0);else if("o"===o)document.getElementById(e.id).className="obstacle",obstacles.push(new Obstacle(e.id));else if("k"===o)document.getElementById(e.id).className="killer",robots.push(new Robot(e.id));else if(parseInt(o)<10){document.getElementById(e.id).className="treasure";var r=new Treasure(e.id);r.value=parseInt(o),treasures.push(r)}else""!==o&&alert("Your input is invalid!")}else alert("You are not in the setup stage!")}function setup(){alert("Setup"),clear()}function clear(){for(var e=0;_size>e;e++)for(var t=0;_size>t;t++)document.getElementById("r"+e+"c"+t).className="";obstacles=[],robots=[],inSetup=!0,theHero=null,haveHero=!1,heroScore=0,robotsScore=0,round=0}function play(){haveHero?(inSetup=!1,round=1,0===treasures.length?end("no treasure"):heroTurn()):alert("You must have one hero!")}function heroTurn(){theHero.detectSurrounding()?window.onkeypress=function(e){var t=e.key;document.getElementById("round").innerHTML="Round: "+round,heroMove(t)}:end("cannot move")}function formatPos(e){return"r"+e[0]+"c"+e[1]}function heroMove(e){var t,o=theHero.getRow(),r=theHero.getCol();switch(e){case"w":t=[o-1,r];break;case"a":t=[o,r-1];break;case"s":t=[o+1,r];break;case"d":t=[o,r+1];break;default:alert("This key is invalid!")}if(t[0]>=0&&t[0]<_size&&t[1]>=0&&t[1]<_size){var n=formatPos(t);console.log(n),theHero.handleSituations(n)}else alert("You can't cross the boundary!");robotTurn()}function robotTurn(){var e=[],t=!0;robots.forEach(function(t,o){var r=t.decideAction();r||(robots.splice(o,1),e.push(t))}),0!==e.length&&(e.forEach(function(e){var o=e.decideAction();o&&(t=!1)}),t&&end("cannot move"))}function end(e){var t="\n	Your score is: "+heroScore,o="";console.log(e),o="kill"===e?"You lose!":heroScore>robotsScore?"You win!":robotsScore>heroScore?"You lose!":"Draw game!",alert(o+t),clear()}var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();document.writeln("<h1>COMP284 Assignment2</h1>"),document.writeln("<h2 id='round'></h2>"),document.writeln("<h2 id='score'></h2>"),document.writeln("<table>");for(var _size=10,i=0;_size>i;i++){document.writeln("<tr>");for(var j=0;_size>j;j++)document.writeln("<td onclick='addItem(this)'id=r"+i+"c"+j+"></td>");document.writeln("</tr>")}document.writeln("</table>");var inSetup=!0,theHero,robots=[],obstacles=[],treasures=[],haveHero=!1,heroScore=0,robotsScore=0,round=0;document.getElementById("score").innerHTML="Hero Score: "+heroScore+" Robots Score:"+robotsScore,document.getElementById("round").innerHTML="Round: "+round;var Item=function(){function e(e){this.location=e}return e.prototype.getLocation=function(){return this.location},e.prototype.getRow=function(){return parseInt(this.location.charAt(1))},e.prototype.getCol=function(){return parseInt(this.location.charAt(3))},e.prototype.setLocation=function(e){document.getElementById(this.getLocation()).className="",this.location=e},e}(),Hero=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.detectSurrounding=function(){var e=[],t=[],o=[],r=[];0!==this.getRow()&&(e=[this.getRow()-1,this.getCol()]),this.getRow()!==_size-1&&(t=[this.getRow()+1,this.getCol()]),0!==this.getCol()&&(o=[this.getRow(),this.getCol()-1]),this.getCol()!==_size-1&&(r=[this.getRow(),this.getCol()+1]);var n=[e,t,o,r];console.log(n);for(var s=!1,a=0,i=n;a<i.length;a++){var c=i[a];console.log(c),0!==c.length&&"obstacle"!==document.getElementById(formatPos(c)).className&&(s=!0)}return s},t.prototype.handleSituations=function(e){var t=document.getElementById(e).className;"obstacle"===t?alert("You can't cross a obstacle!"):(round++,"killer"===t?(document.getElementById(this.getLocation()).className="",end("kill")):("treasure"===t&&treasures.forEach(function(t,o){t.getLocation()===e&&(heroScore+=t.getValue(),console.log(heroScore),document.getElementById("score").innerHTML="Hero Score: "+heroScore+" Robots Score:"+robotsScore,treasures.splice(o,1))}),this.moveForward(e),0===treasures.length&&end("no treasure")))},t.prototype.moveForward=function(e){document.getElementById(this.getLocation()).className="",document.getElementById(e).className="hero",this.setLocation(e)},t}(Item),Robot=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.moveForward=function(e){document.getElementById(this.getLocation()).className="",document.getElementById(e).className="killer",this.setLocation(e)},t.prototype.detectSurrounding=function(){for(var e=this.getRow(),t=this.getCol(),o=[],r=[],n=!1,s=0===e?0:e-1;(e===_size-1?_size-1:e+1)>=s;s++)for(var a=0===t?0:t-1;(t===_size-1?_size-1:t+1)>=a;a++){var i=formatPos([s,a]),c=document.getElementById(i).className;if("hero"===c)return["hero",i];"treasure"===c?(n||(n=!0),r.push(i)):""!==c||n||o.push(i)}if(n){var u=Math.floor(Math.random()*r.length);return["treasure",r[u]]}if(0!==o.length){var u=Math.floor(Math.random()*o.length);return["free",o[u]]}return["none"]},t.prototype.decideAction=function(){var e=this,t=this.detectSurrounding(),o=t[0];if("hero"===o)this.moveForward(t[1]),end("kill");else if("treasure"===o)treasures.forEach(function(o,r){o.getLocation()===t[1]&&(robotsScore+=o.getValue(),console.log(heroScore),document.getElementById("score").innerHTML="Hero Score: "+heroScore+" Robots Score: "+robotsScore,treasures.splice(r,1),e.moveForward(t[1]))}),0===treasures.length&&end("no treasure");else{if("free"!==o)return!1;this.moveForward(t[1])}return!0},t}(Item),Obstacle=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Item),Treasure=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getValue=function(){return this.value},t}(Item);